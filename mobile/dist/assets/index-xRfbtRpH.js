import{M as R,ab as he,a5 as x,O as F,l as Q,n as j,Q as le,p as ce,aD as ge,D as ie,f as g,T as _,a2 as D,r as w,K as se,N as be,G as p,$ as Z,m as ue,L as B,a1 as Oe,q as G,ar as q,S as Te,F as pe,J as W,Y as ee,X as ye,aE as ke,aF as xe,P as Ce,aG as re}from"./index-DE8r4v9z.js";const[Ee,T,te]=R("picker"),me=e=>e.find(o=>!o.disabled)||e[0];function we(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function $(e,o){o=F(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ne=(e,o,n)=>o!==void 0&&e.some(i=>i[n.value]===o);function J(e,o,n){const i=e.findIndex(d=>d[n.value]===o),l=$(e,i);return e[l]}function Pe(e,o,n){const i=[];let l={[o.children]:e},d=0;for(;l&&l[o.children];){const m=l[o.children],f=n.value[d];if(l=he(f)?J(m,f,o):void 0,!l&&m.length){const r=me(m)[o.value];l=J(m,r,o)}d++,i.push(m)}return i}function Se(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function Ie(e){return x({text:"text",value:"value",children:"children"},e)}const oe=200,ae=300,De=15,[de,z]=R("picker-column"),fe=Symbol(de);var Me=Q({name:de,props:{value:j,fields:_(Object),options:D(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(j),visibleOptionNum:_(j)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let i,l,d,m,f;const r=w(),b=w(),v=w(0),h=w(0),y=be(),C=()=>e.options.length,M=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=c=>{let u=$(e.options,c);const t=-u*e.optionHeight,a=()=>{u>C()-1&&(u=$(e.options,c));const s=e.options[u][e.fields.value];s!==e.value&&o("change",s)};i&&t!==v.value?f=a:a(),v.value=t},O=()=>e.readonly||!e.options.length,K=c=>{i||O()||(f=null,h.value=oe,k(c),o("clickOption",e.options[c]))},E=c=>F(Math.round(-c/e.optionHeight),0,C()-1),H=p(()=>E(v.value)),Y=(c,u)=>{const t=Math.abs(c/u);c=v.value+t/.003*(c<0?-1:1);const a=E(c);h.value=+e.swipeDuration,k(a)},P=()=>{i=!1,h.value=0,f&&(f(),f=null)},U=c=>{if(!O()){if(y.start(c),i){const u=Se(b.value);v.value=Math.min(0,u-M())}h.value=0,l=v.value,d=Date.now(),m=l,f=null}},L=c=>{if(O())return;y.move(c),y.isVertical()&&(i=!0,se(c,!0));const u=F(l+y.deltaY.value,-(C()*e.optionHeight),e.optionHeight),t=E(u);t!==H.value&&o("scrollInto",e.options[t]),v.value=u;const a=Date.now();a-d>ae&&(d=a,m=u)},S=()=>{if(O())return;const c=v.value-m,u=Date.now()-d;if(u<ae&&Math.abs(c)>De){Y(c,u);return}const a=E(v.value);h.value=oe,k(a),setTimeout(()=>{i=!1},0)},N=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((u,t)=>{const a=u[e.fields.text],{disabled:s}=u,V=u[e.fields.value],I={role:"button",style:c,tabindex:s?-1:0,class:[z("item",{disabled:s,selected:V===e.value}),u.className],onClick:()=>K(t)},ve={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:a};return g("li",I,[n.option?n.option(u,t):g("div",ve,null)])})};return le(fe),ce({stopMomentum:P}),ge(()=>{const c=i?Math.floor(-v.value/e.optionHeight):e.options.findIndex(a=>a[e.fields.value]===e.value),u=$(e.options,c),t=-u*e.optionHeight;i&&u<c&&P(),v.value=t}),ie("touchmove",L,{target:r}),()=>g("div",{ref:r,class:z(),onTouchstartPassive:U,onTouchend:S,onTouchcancel:S},[g("ul",{ref:b,style:{transform:`translate3d(0, ${v.value+M()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:z("wrapper"),onTransitionend:P},[N()])])}});const[He]=R("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},Ne=["cancel","confirm","title","toolbar"],Ve=Object.keys(A);var _e=Q({name:He,props:A,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const i=()=>{if(n.title)return n.title();if(e.title)return g("div",{class:[T("title"),"van-ellipsis"]},[e.title])},l=()=>o("cancel"),d=()=>o("confirm"),m=()=>{var r;const b=(r=e.cancelButtonText)!=null?r:te("cancel");if(!(!n.cancel&&!b))return g("button",{type:"button",class:[T("cancel"),Z],onClick:l},[n.cancel?n.cancel():b])},f=()=>{var r;const b=(r=e.confirmButtonText)!=null?r:te("confirm");if(!(!n.confirm&&!b))return g("button",{type:"button",class:[T("confirm"),Z],onClick:d},[n.confirm?n.confirm():b])};return()=>g("div",{class:T("toolbar")},[n.toolbar?n.toolbar():[m(),i(),f()]])}});const[Be]=R("picker-group"),$e=Symbol(Be);x({tabs:D(),activeTab:B(0),nextStepText:String,showToolbar:ue},A);const X=x({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:ue,swipeDuration:B(1e3),visibleOptionNum:B(6)},A),Fe=x({},X,{columns:D(),modelValue:D(),toolbarPosition:Oe("top"),columnsFieldNames:Object});var Re=Q({name:Ee,props:Fe,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const i=w(),l=w(e.modelValue.slice(0)),{parent:d}=le($e),{children:m,linkChildren:f}=pe(fe);f();const r=p(()=>Ie(e.columnsFieldNames)),b=p(()=>ke(e.optionHeight)),v=p(()=>we(e.columns,r.value)),h=p(()=>{const{columns:t}=e;switch(v.value){case"multiple":return t;case"cascade":return Pe(t,r.value,l);default:return[t]}}),y=p(()=>h.value.some(t=>t.length)),C=p(()=>h.value.map((t,a)=>J(t,l.value[a],r.value))),M=p(()=>h.value.map((t,a)=>t.findIndex(s=>s[r.value.value]===l.value[a]))),k=(t,a)=>{if(l.value[t]!==a){const s=l.value.slice(0);s[t]=a,l.value=s}},O=()=>({selectedValues:l.value.slice(0),selectedOptions:C.value,selectedIndexes:M.value}),K=(t,a)=>{k(a,t),v.value==="cascade"&&l.value.forEach((s,V)=>{const I=h.value[V];ne(I,s,r.value)||k(V,I.length?I[0][r.value.value]:void 0)}),W(()=>{o("change",x({columnIndex:a},O()))})},E=(t,a)=>{const s={columnIndex:a,currentOption:t};o("clickOption",x(O(),s)),o("scrollInto",s)},H=()=>{m.forEach(a=>a.stopMomentum());const t=O();return W(()=>{const a=O();o("confirm",a)}),t},Y=()=>o("cancel",O()),P=()=>h.value.map((t,a)=>g(Me,{value:l.value[a],fields:r.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:s=>K(s,a),onClickOption:s=>E(s,a),onScrollInto:s=>{o("scrollInto",{currentOption:s,columnIndex:a})}},{option:n.option})),U=t=>{if(y.value){const a={height:`${b.value}px`},s={backgroundSize:`100% ${(t-b.value)/2}px`};return[g("div",{class:T("mask"),style:s},null),g("div",{class:[xe,T("frame")],style:a},null)]}},L=()=>{const t=b.value*+e.visibleOptionNum,a={height:`${t}px`};return!e.loading&&!y.value&&n.empty?n.empty():g("div",{ref:i,class:T("columns"),style:a},[P(),U(t)])},S=()=>{if(e.showToolbar&&!d)return g(_e,ye(ee(e,Ve),{onConfirm:H,onCancel:Y}),ee(n,Ne))},N=t=>{t.forEach((a,s)=>{a.length&&!ne(a,l.value[s],r.value)&&k(s,me(a)[r.value.value])})};G(h,t=>N(t),{immediate:!0});let c;return G(()=>e.modelValue,t=>{!q(t,l.value)&&!q(t,c)&&(l.value=t.slice(0),c=t.slice(0)),e.modelValue.length===0&&N(h.value)},{deep:!0}),G(l,t=>{q(t,e.modelValue)||(c=t.slice(0),o("update:modelValue",c))},{immediate:!0}),ie("touchmove",se,{target:i}),ce({confirm:H,getSelectedOptions:()=>C.value}),()=>{var t,a;return g("div",{class:T()},[e.toolbarPosition==="top"?S():null,e.loading?g(Te,{class:T("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),L(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?S():null])}}});const Ye=Ce(Re),Ue=x({},X,{modelValue:D(),filter:Function,formatter:{type:Function,default:(e,o)=>o}}),Le=Object.keys(X);function Ae(e,o){if(e<0)return[];const n=Array(e);let i=-1;for(;++i<e;)n[i]=o(i);return n}const je=(e,o)=>32-new Date(e,o-1,32).getDate(),Ge=(e,o,n,i,l,d)=>{const m=Ae(o-e+1,f=>{const r=re(e+f);return i(n,{text:r,value:r})});return l?l(n,m,d):m},qe=(e,o)=>e.map((n,i)=>{const l=o[i];if(l.length){const d=+l[0].value,m=+l[l.length-1].value;return re(F(+n,d,m))}return n});export{Ye as P,Ge as a,qe as f,je as g,Le as p,Ue as s};
