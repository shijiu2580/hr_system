import"./index-BfNrj1Io.js";import{T as S,a as z}from"./index-PtygPl2G.js";import{B as A}from"./index-ck5WoTsJ.js";/* empty css              */import{a as G,C as L}from"./index-CcX8rTri.js";import{F as j}from"./index-DmReRFXi.js";import{I as E}from"./index-D57cqCsI.js";import{N as H}from"./index-QT4Twd0-.js";import{_ as q,u as J,a as K,o as O,b as V,c as D,f as t,e as a,ah as Q,w as l,t as f,g,G as c,r as y,j as W}from"./index-DE8r4v9z.js";import{D as X,s as Y,a as v}from"./index-5LrtQatF.js";import{F as Z}from"./index-B3pv3eh3.js";import"./use-placeholder-33bInLsI.js";const ee={class:"page-container"},oe={class:"user-card"},te={class:"avatar-placeholder"},se={key:1,class:"avatar-placeholder-wrapper"},ae={class:"avatar-placeholder"},le={class:"user-info"},ne={class:"user-name"},re={class:"user-id"},ie={class:"user-dept"},de={style:{padding:"20px 16px"}},pe={__name:"Me",setup(ue){const U=J(),n=K(),I=y(2);O(async()=>{n.isLoggedIn&&await n.fetchProfile()});const C=c(()=>{var o;return((o=n.employeeInfo)==null?void 0:o.avatar)||""}),x=c(()=>{var o,e;return((o=n.employeeInfo)==null?void 0:o.name)||((e=n.userInfo)==null?void 0:e.username)||"用户"}),$=c(()=>x.value.charAt(0)),F=c(()=>{var o;return(o=n.employeeInfo)!=null&&o.employee_id?`员工编号:${n.employeeInfo.employee_id}`:""}),N=c(()=>{var o;return((o=n.employeeInfo)==null?void 0:o.department)||"未分配"}),T=c(()=>{var o;return((o=n.employeeInfo)==null?void 0:o.position)||"未分配"}),k=y(!1),b=y(!1),i=y({old_password:"",new_password:"",confirm_password:""});async function M(o){var r,p,w,u;if(o==="cancel")return!0;const{old_password:e,new_password:d,confirm_password:_}=i.value;if(!e||!d||!_)return await v({title:"提示",message:"请填写完整信息"}),!1;if(d.length<8)return await v({title:"提示",message:"新密码至少8位"}),!1;if(d!==_)return await v({title:"提示",message:"两次密码不一致"}),!1;try{const m=await W.post("/api/auth/change_password/",{old_password:e,new_password:d,confirm_password:_});return m.data.success?(i.value={old_password:"",new_password:"",confirm_password:""},setTimeout(()=>{v({title:"成功",message:"密码修改成功"})},300),!0):(await v({title:"修改失败",message:((r=m.data.error)==null?void 0:r.message)||"请检查输入"}),!1)}catch(m){return await v({title:"修改失败",message:((u=(w=(p=m.response)==null?void 0:p.data)==null?void 0:w.error)==null?void 0:u.message)||"请检查输入"}),!1}}function P(){Y({title:"提示",message:"确定要退出登录吗？"}).then(()=>{n.logout(),U.replace("/welcome")}).catch(()=>{})}return(o,e)=>{const d=H,_=E,r=G,p=L,w=A,u=j,m=Z,B=X,h=S,R=z;return V(),D("div",ee,[t(d,{title:"我的"}),a("div",oe,[C.value?(V(),Q(_,{key:0,round:"",width:"60",height:"60",src:C.value,fit:"cover"},{error:l(()=>[a("div",te,f($.value),1)]),_:1},8,["src"])):(V(),D("div",se,[a("div",ae,f($.value),1)])),a("div",le,[a("div",ne,f(x.value),1),a("div",re,f(F.value),1),a("div",ie,f(N.value)+" · "+f(T.value),1)])]),t(p,{inset:""},{default:l(()=>[t(r,{title:"个人资料",icon:"user-o","is-link":"",onClick:e[0]||(e[0]=s=>o.$router.push("/profile"))}),t(r,{title:"考勤记录",icon:"calendar-o","is-link":"",onClick:e[1]||(e[1]=s=>o.$router.push("/attendance"))}),t(r,{title:"请假记录",icon:"edit","is-link":"",onClick:e[2]||(e[2]=s=>o.$router.push("/leave"))})]),_:1}),t(p,{inset:"",style:{"margin-top":"12px"}},{default:l(()=>[t(r,{title:"入职进度",icon:"clock-o","is-link":"",onClick:e[3]||(e[3]=s=>o.$router.push("/status"))}),t(r,{title:"修改密码",icon:"lock","is-link":"",onClick:e[4]||(e[4]=s=>k.value=!0)}),t(r,{title:"关于",icon:"info-o","is-link":"",onClick:e[5]||(e[5]=s=>b.value=!0)})]),_:1}),a("div",de,[t(w,{type:"danger",block:"",round:"",plain:"",onClick:P},{default:l(()=>[...e[12]||(e[12]=[g(" 退出登录 ",-1)])]),_:1})]),t(B,{show:k.value,"onUpdate:show":e[9]||(e[9]=s=>k.value=s),title:"修改密码","show-cancel-button":"","before-close":M},{default:l(()=>[t(m,{ref:"passwordFormRef"},{default:l(()=>[t(p,null,{default:l(()=>[t(u,{modelValue:i.value.old_password,"onUpdate:modelValue":e[6]||(e[6]=s=>i.value.old_password=s),type:"password",label:"旧密码",placeholder:"请输入旧密码"},null,8,["modelValue"]),t(u,{modelValue:i.value.new_password,"onUpdate:modelValue":e[7]||(e[7]=s=>i.value.new_password=s),type:"password",label:"新密码",placeholder:"请输入新密码（至少8位）"},null,8,["modelValue"]),t(u,{modelValue:i.value.confirm_password,"onUpdate:modelValue":e[8]||(e[8]=s=>i.value.confirm_password=s),type:"password",label:"确认密码",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1})]),_:1},512)]),_:1},8,["show"]),t(B,{show:b.value,"onUpdate:show":e[10]||(e[10]=s=>b.value=s),title:"关于","confirm-button-text":"知道了"},{default:l(()=>[...e[13]||(e[13]=[a("div",{style:{padding:"20px","text-align":"center"}},[a("div",{style:{"font-size":"18px","font-weight":"500"}},"HR员工自助系统"),a("div",{style:{color:"#969799","margin-top":"8px"}},"版本 1.0.0"),a("div",{style:{color:"#969799","margin-top":"16px","font-size":"13px"}}," 提供入职登记、签到打卡、请假申请等自助服务 ")],-1)])]),_:1},8,["show"]),t(R,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=s=>I.value=s),fixed:""},{default:l(()=>[t(h,{icon:"home-o",to:"/home"},{default:l(()=>[...e[14]||(e[14]=[g("首页",-1)])]),_:1}),t(h,{icon:"location-o",to:"/checkin"},{default:l(()=>[...e[15]||(e[15]=[g("打卡",-1)])]),_:1}),t(h,{icon:"user-o",to:"/me"},{default:l(()=>[...e[16]||(e[16]=[g("我的",-1)])]),_:1})]),_:1},8,["modelValue"])])}}},Ie=q(pe,[["__scopeId","data-v-dcef0fb9"]]);export{Ie as default};
